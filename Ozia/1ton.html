<html lang="en">
  <head>
    <title>FM GLASSES AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://api.fittingmonster.com/css/api/fm.api_v5.css" />

    <style>
      body, html {
        height: 100%;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .fm-fitting-btn {
        padding: 10px 20px;
        font-size: 16px;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>

  </head>
  <body>
    <!-- TRY ON button -->
    <button class="fm-fitting-btn btn-fm">
      <div>Tester mes lentilles</div>
    </button>
    
    <!-- Fitting display -->
    <div id="fm-fitting-display"></div>
    <!-- Customized UI sample -->
    <div id="fitting-custom-ui" class="fm-iframe-custom-ui">
      <div class="container" id="fm-capture-preview" style="display:block;">
        <img src="https://apilive.fittingmonster.com/iframe/img/v2/i_exit.png" class="fm-capture-close cursor-pointer" onclick="closeFitting();" />
      </div>
      <input class="fm-op-slider" type="range" min="0" max="100" value="80">
      <div class="fm-op-photo" id="fm-capture">
        <img src="https://apilive.fittingmonster.com/iframe/img/v2/i_camera.png" class="fm-capture-close cursor-pointer" onclick="fmCapture();" style="width:50px; height:50px; background-color: #fff;border-radius: 50%;" />
      </div>
    </div>
    <!-- Popup background -->
    <div id="fm-popup-bg"></div>
 
    <!--Load the AJAX API-->
    <script src="https://code.jquery.com/jquery.min.js"></script>
    <script src="https://api.fittingmonster.com/js/api/fm.api.live_v2.js"></script>
    <script>
      /* Setting companykey */
      let companykey = "xlei4EaTNrAe5kMVsNGXD26eCMwfSXsNveYjl4BpV+wFnyNMR6ij/X3vKIrTDKyX";
 
      /* Setting productkey */
      var productkey = "OzClt,OzClt_1,OzClt_2,OzClt_3";
 
      /* Productkey setting sample */
      /*
      var productkey = getUrlParams().id;
      function getUrlParams() {
        var params = {};
        window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(str, key, value) {
          params[key] = value;
        });
        return params;
      }
      */
 
      /* productkey validation */
      checkProductKey(function (result) {
        if (result == 0) {
          $('.fm-fitting-btn').show();
          console.log("success");
        } else if (result == -1) {
          $('.fm-fitting-btn').hide();
          console.log("No receive information");
        } else if (result == 1) {
          $('.fm-fitting-btn').hide();
          console.log("Companykey error");
        } else if (result == 2) {
          $('.fm-fitting-btn').hide();
          console.log("Productkey error");
        } else if (result == 3) {
          $('.fm-fitting-btn').hide();
          console.log("Not supported app");
        }
      });
 
      /* Setting customized ui */
      fmCustomUI = true; // Whether to use customized UI
      fmFittingOpenCallback = function() {
        console.log(fmFittingProductList);
        $("#fitting-custom-ui").addClass("on");

        var keys = Object.keys(fmFittingProductList);
        for (var i = 0; i < keys.length; i++) {
          var key = keys[i];
          var tmpHtml = `<div id="product_0${i + 1}" class="round-box fm_model cursor-pointer" value="${key}" style='width:50px;height:50px;' onclick='fitting("${key}")'>
                          <img class="circle" src="${fmFittingProductList[key].FrontImage}" align="center">
                        </div>`;
          $("#fitting-custom-ui").append(tmpHtml);
        }

        if (fittingType == 1) {
          $('.fm-op-slider').hide();
        } else {
          $('.fm-op-slider').show();
        }
      }

      function fitting(productkey) {
        fmFitting(productkey)
      }

      function closeFitting() {
        $("#fitting-custom-ui").removeClass("on");
        fmFittingClose();
      }

      $('.fm-op-slider[type=range]').on('input', function() {
        var val = $(this).val();
        fmSetLensEffect(val);
      });

      lensAlpha = 50;

      fmCaptureCallback = function(data) {
        var link = document.createElement('a');
        link.download = fmCaptureFilename;
        link.href = data;
        link.click();
      }

      fmCaptureFilename = 'fm-fitting-capture.png';
    </script>
  </body>
</html>
